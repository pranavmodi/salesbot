{% extends 'base.html' %}
{% block content %}
<h2>Inbox & Sent Emails (Threads)</h2>
<div class="accordion" id="threadsAccordion">
    {% for thread in threads %}
    {% set latest_email = thread[-1] %}
    <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ loop.index }}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" aria-expanded="false" aria-controls="collapse{{ loop.index }}">
                <strong>{{ latest_email.subject or 'No Subject' }}</strong> &mdash; {{ latest_email.from }} &rarr; {{ latest_email.to }}
                <span class="ms-3 text-muted small">({{ thread|length }} message{{ 's' if thread|length > 1 else '' }})</span>
            </button>
        </h2>
        <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" aria-labelledby="heading{{ loop.index }}" data-bs-parent="#threadsAccordion">
            <div class="accordion-body">
                <ul class="list-group">
                    {% for email in thread %}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="fw-bold">{{ email.from }}</span>
                                <span class="mx-2">&rarr;</span>
                                <span class="fw-bold">{{ email.to }}</span>
                                <span class="badge bg-secondary ms-2">{{ email.folder }}</span>
                            </div>
                            <span class="text-muted small">{{ email.date.strftime('%Y-%m-%d %H:%M') if email.date else '' }}</span>
                        </div>
                        <div class="mt-2">
                            <div class="fw-semibold">Subject: {{ email.subject or 'No Subject' }}</div>
                            <div class="text-truncate" style="max-width: 100%; white-space: pre-line;">{{ email.body }}</div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% if not threads or threads|length == 0 %}
<p>No emails found.</p>
{% endif %}
{% endblock %} 