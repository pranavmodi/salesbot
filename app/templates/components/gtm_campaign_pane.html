<!-- GTM Campaign Pane Component -->
<div class="card">
    <div class="card-header">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h5 class="card-title mb-0">
                    <i class="fas fa-bullhorn me-2"></i>GTM Campaign Management
                </h5>
                <small class="text-muted">Create and manage go-to-market campaigns</small>
            </div>
            <div class="col-md-6">
                <div class="d-flex justify-content-end align-items-center gap-2">
                    <div class="input-group" style="max-width: 280px;">
                        <input type="text" class="form-control form-control-sm search-box" placeholder="Search campaigns..." id="campaignSearch">
                        <button class="btn btn-outline-secondary btn-sm" type="button" onclick="clearCampaignSearch()" title="Clear search">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="btn-group" role="group">
                        <button id="deleteAllCampaigns" class="btn btn-outline-danger btn-sm" onclick="deleteAllCampaigns()" title="Delete all campaigns and associated data">
                            <i class="fas fa-trash me-1"></i>Delete All
                        </button>
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createCampaignModal">
                            <i class="fas fa-plus me-1"></i>Create Campaign
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body">
        <!-- Campaign Stats Row -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="totalCampaigns">0</div>
                    <div class="stats-label">Active Campaigns</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="campaignEmailsSent">0</div>
                    <div class="stats-label">Emails Sent</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="campaignResponseRate">0%</div>
                    <div class="stats-label">Response Rate</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="campaignConversionRate">0%</div>
                    <div class="stats-label">Conversion Rate</div>
                </div>
            </div>
        </div>

        <!-- All Campaigns List -->
        <div id="allCampaignsContainer">
            <!-- All campaigns will be loaded here -->
            <div class="text-center text-muted py-4">
                <i class="fas fa-bullhorn fa-3x mb-3"></i>
                <p>No campaigns yet. Create your first GTM campaign to get started!</p>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createCampaignModal">
                    <i class="fas fa-plus me-1"></i>Create Campaign
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Create Campaign Modal - Multi-step Workflow -->
<div class="modal fade" id="createCampaignModal" tabindex="-1" aria-labelledby="createCampaignModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createCampaignModalLabel">
                    <i class="fas fa-bullhorn me-2"></i>Create New GTM Campaign
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <!-- Progress Steps -->
            <div class="modal-header border-0 pb-0">
                <div class="campaign-progress-container w-100">
                    <div class="progress-steps">
                        <div class="step-item active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">Campaign Details</div>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step-item" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">Select Contacts</div>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step-item" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">Email Settings</div>
                        </div>
                        <div class="step-connector"></div>
                        <div class="step-item" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">Review & Launch</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-body">
                <form id="createCampaignForm">
                    <!-- Step 1: Campaign Details -->
                    <div class="step-content" id="step1" data-step="1">
                        <div class="step-header">
                            <h4 class="step-title">
                                <i class="fas fa-info-circle text-primary me-2"></i>Campaign Details
                            </h4>
                            <p class="text-muted">Define the basic information for your GTM campaign</p>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label for="campaignName" class="form-label fw-semibold">Campaign Name *</label>
                                    <input type="text" class="form-control form-control-lg" id="campaignName" 
                                           placeholder="e.g., Q2 Product Launch Outreach" required>
                                    <div class="form-text">Choose a descriptive name for your campaign</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label for="campaignType" class="form-label fw-semibold">Campaign Type *</label>
                                    <select class="form-select form-select-lg" id="campaignType" required>
                                        <option value="">Select Campaign Type</option>
                                        <option value="cold_outreach">üéØ Cold Outreach</option>
                                        <option value="warm_followup">ü§ù Warm Follow-up</option>
                                        <option value="product_launch">üöÄ Product Launch</option>
                                        <option value="nurture_sequence">üìà Nurture Sequence</option>
                                        <option value="reactivation">üîÑ Reactivation</option>
                                    </select>
                                    <div class="form-text">Select the type that best describes your campaign</div>
                                </div>
                            </div>
                        </div>
                        
                    </div>

                    <!-- Step 2: Contact Selection -->
                    <div class="step-content d-none" id="step2" data-step="2">
                        <div class="step-header">
                            <h4 class="step-title">
                                <i class="fas fa-users text-primary me-2"></i>Select Target Contacts
                            </h4>
                            <p class="text-muted">Choose which contacts to include in your campaign</p>
                        </div>

                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="btn-group w-100" role="group" aria-label="Selection method">
                                            <input type="radio" class="btn-check" name="selectionMethod" id="quickFilter" value="quick" checked>
                                            <label class="btn btn-outline-primary" for="quickFilter">
                                                <i class="fas fa-filter me-1"></i>Quick Filter
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="selectionMethod" id="manualSelect" value="manual">
                                            <label class="btn btn-outline-primary" for="manualSelect">
                                                <i class="fas fa-hand-pointer me-1"></i>Manual Selection
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="selectionMethod" id="advancedFilter" value="advanced">
                                            <label class="btn btn-outline-primary" for="advancedFilter">
                                                <i class="fas fa-cogs me-1"></i>Advanced Filter
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <span class="badge bg-primary fs-6 px-3 py-2" id="selectedContactsCount">0 contacts selected</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Quick Filter Options -->
                                <div id="quickFilterOptions" class="selection-method-content">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="quickFilterType" class="form-label fw-semibold">Filter Type</label>
                                                <select class="form-select" id="quickFilterType" onchange="updateContactCount()">
                                                    <option value="all">üìã All Contacts</option>
                                                    <option value="uncontacted">‚úâÔ∏è Uncontacted Only</option>
                                                    <option value="has_phone">üìû Contacts with Phone</option>
                                                    <option value="has_linkedin">üîó Contacts with LinkedIn</option>
                                                    <option value="recent">üÜï Recently Added</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="companyFilter" class="form-label fw-semibold">Company Filter</label>
                                                <select class="form-select" id="companyFilter" onchange="updateContactCount()">
                                                    <option value="">All Companies</option>
                                                    <!-- Will be populated dynamically -->
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Manual Selection -->
                                <div id="manualSelectionOptions" class="selection-method-content d-none">
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Search Contacts</label>
                                        <div class="input-group input-group-lg">
                                            <input type="text" class="form-control" id="contactSearchCampaign" 
                                                   placeholder="Search by name, email, company, or job title...">
                                            <button class="btn btn-primary" type="button" onclick="searchContactsForCampaign()">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="contact-selection-container" style="max-height: 350px; overflow-y: auto;">
                                        <div id="campaignContactsList">
                                            <!-- Contacts will be loaded here -->
                                            <div class="text-center text-muted py-4">
                                                <i class="fas fa-search fa-3x mb-3 text-secondary"></i>
                                                <h6>Search for contacts to select them</h6>
                                                <p class="small">Use the search box above to find specific contacts</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Advanced Filter -->
                                <div id="advancedFilterOptions" class="selection-method-content d-none">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="advancedCompany" class="form-label fw-semibold">Company Contains</label>
                                                <input type="text" class="form-control" id="advancedCompany" 
                                                       placeholder="Company name" onchange="updateContactCount()">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="advancedTitle" class="form-label fw-semibold">Job Title Contains</label>
                                                <input type="text" class="form-control" id="advancedTitle" 
                                                       placeholder="Job title" onchange="updateContactCount()">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="advancedLocation" class="form-label fw-semibold">Location Contains</label>
                                                <input type="text" class="form-control" id="advancedLocation" 
                                                       placeholder="Location" onchange="updateContactCount()">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6 class="fw-semibold mb-3">Contact Requirements</h6>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="excludeContacted" onchange="updateContactCount()" checked>
                                                <label class="form-check-label" for="excludeContacted">
                                                    Exclude already contacted
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="requirePhone" onchange="updateContactCount()">
                                                <label class="form-check-label" for="requirePhone">
                                                    Require phone number
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 class="fw-semibold mb-3">Additional Filters</h6>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="requireLinkedIn" onchange="updateContactCount()">
                                                <label class="form-check-label" for="requireLinkedIn">
                                                    Require LinkedIn profile
                                                </label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="excludeInactiveCampaigns" onchange="updateContactCount()">
                                                <label class="form-check-label" for="excludeInactiveCampaigns">
                                                    Exclude from other active campaigns
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Selected Contacts Preview -->
                                <div id="selectedContactsPreview" class="mt-4 d-none">
                                    <h6 class="fw-semibold text-primary">
                                        <i class="fas fa-eye me-2"></i>Selected Contacts Preview
                                    </h6>
                                    <div class="selected-contacts-list" style="max-height: 150px; overflow-y: auto;">
                                        <!-- Preview will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Email Settings -->
                    <div class="step-content d-none" id="step3" data-step="3">
                        <div class="step-header">
                            <h4 class="step-title">
                                <i class="fas fa-envelope text-primary me-2"></i>Email Configuration
                            </h4>
                            <p class="text-muted">Configure your email template and execution preferences</p>
                        </div>

                        <!-- Execution Mode Selection -->
                        <div class="card border-primary mb-4">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-rocket me-2"></i>Campaign Execution Mode
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="btn-group w-100 mb-3" role="group" aria-label="Execution mode">
                                            <input type="radio" class="btn-check" name="executionMode" id="scheduledMode" value="scheduled" checked>
                                            <label class="btn btn-outline-primary" for="scheduledMode">
                                                <div class="text-center">
                                                    <i class="fas fa-calendar-alt fa-2x d-block mb-2"></i>
                                                    <strong>Scheduled Execution</strong>
                                                    <br><small>Automated sending with timing controls</small>
                                                </div>
                                            </label>
                                            
                                            <input type="radio" class="btn-check" name="executionMode" id="manualMode" value="manual">
                                            <label class="btn btn-outline-success" for="manualMode">
                                                <div class="text-center">
                                                    <i class="fas fa-hand-paper fa-2x d-block mb-2"></i>
                                                    <strong>Manual Execution</strong>
                                                    <br><small>Send emails via Compose tab</small>
                                                </div>
                                            </label>
                                        </div>
                                        
                                        <!-- Scheduled Mode Benefits -->
                                        <div id="scheduledBenefits" class="execution-benefits">
                                            <div class="alert alert-info mb-0">
                                                <strong><i class="fas fa-info-circle me-1"></i>Scheduled Mode Benefits:</strong>
                                                <ul class="mb-0 mt-2">
                                                    <li><strong>Automated delivery</strong> - Emails sent automatically based on timing rules</li>
                                                    <li><strong>Business hours respect</strong> - Emails only sent during configured business hours</li>
                                                    <li><strong>Rate limiting</strong> - Prevents spam triggers with controlled sending pace</li>
                                                    <li><strong>Follow-up sequences</strong> - Automatic follow-ups for non-responders</li>
                                                </ul>
                                            </div>
                                        </div>
                                        
                                        <!-- Manual Mode Benefits -->
                                        <div id="manualBenefits" class="execution-benefits" style="display: none;">
                                            <div class="alert alert-success mb-0">
                                                <strong><i class="fas fa-info-circle me-1"></i>Manual Mode Benefits:</strong>
                                                <ul class="mb-0 mt-2">
                                                    <li><strong>Full control</strong> - Send emails when you choose via Compose tab</li>
                                                    <li><strong>Review before send</strong> - Preview and customize each email individually</li>
                                                    <li><strong>Immediate sending</strong> - No delays or scheduling restrictions</li>
                                                    <li><strong>Perfect for testing</strong> - Ideal for campaign validation and A/B testing</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label for="emailTemplate" class="form-label fw-semibold">Email Template *</label>
                                    <select class="form-select form-select-lg" id="emailTemplate" required>
                                        <option value="">Select Email Template</option>
                                        <option value="deep_research" selected>üî¨ Deep Research</option>
                                        <option value="content_based">üìÑ Content-Based Marketing</option>
                                        <option value="possible_minds">üè¢ Possible Minds Template</option>
                                        <option value="custom">‚úèÔ∏è Custom Template</option>
                                    </select>
                                    <div class="form-text">Choose the email template that fits your campaign goals. Deep Research leverages company intelligence for personalized outreach.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-4">
                                    <label for="emailSubjectLine" class="form-label fw-semibold">Custom Subject Line</label>
                                    <input type="text" class="form-control" id="emailSubjectLine" 
                                           placeholder="Optional: Override template subject">
                                    <div class="form-text">Leave blank to use template default</div>
                                </div>
                            </div>
                        </div>

                        <!-- Scheduled Mode Settings -->
                        <div id="scheduledModeSettings">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-4">
                                        <label for="scheduleDate" class="form-label fw-semibold">Send Schedule</label>
                                        <input type="datetime-local" class="form-control" id="scheduleDate">
                                        <div class="form-text">Leave blank to send immediately after creation</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-4">
                                        <label for="followupDays" class="form-label fw-semibold">Follow-up Schedule</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="followupDays" 
                                                   placeholder="3" min="1" max="30" value="3">
                                            <span class="input-group-text">days later</span>
                                        </div>
                                        <div class="form-text">Automatic follow-up delay for non-responders</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Email Sending Settings -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">
                                    <i class="fas fa-cog me-2"></i>Email Sending Settings
                                </label>
                            <div class="card border-light bg-light">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="emailFrequency" class="form-label fw-semibold">Base Time Between Emails</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="emailFrequencyValue" 
                                                           value="30" min="1" max="1440">
                                                    <select class="form-select" id="emailFrequencyUnit" style="max-width: 100px;">
                                                        <option value="minutes" selected>Minutes</option>
                                                        <option value="hours">Hours</option>
                                                    </select>
                                                </div>
                                                <div class="form-text">Base interval between emails</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="campaignTimezone" class="form-label fw-semibold">Campaign Timezone</label>
                                                <select class="form-select" id="campaignTimezone">
                                                    <!-- American Time Zones -->
                                                    <option value="Pacific/Honolulu">Hawaii Time (HST)</option>
                                                    <option value="America/Anchorage">Alaska Time (AKST)</option>
                                                    <option value="America/Los_Angeles" selected>Pacific Time (PST/PDT)</option>
                                                    <option value="America/Phoenix">Arizona Time (MST - No DST)</option>
                                                    <option value="America/Denver">Mountain Time (MST/MDT)</option>
                                                    <option value="America/Chicago">Central Time (CST/CDT)</option>
                                                    <option value="America/New_York">Eastern Time (EST/EDT)</option>
                                                    <option value="America/Halifax">Atlantic Time (AST/ADT)</option>
                                                    <!-- Other Major Time Zones -->
                                                    <option value="UTC">UTC</option>
                                                    <option value="Europe/London">London (GMT/BST)</option>
                                                    <option value="Europe/Paris">Paris (CET/CEST)</option>
                                                    <option value="Asia/Kolkata">India Standard Time (IST)</option>
                                                    <option value="Asia/Tokyo">Tokyo (JST)</option>
                                                    <option value="Asia/Shanghai">Shanghai (CST)</option>
                                                    <option value="Australia/Sydney">Sydney (AEST/AEDT)</option>
                                                </select>
                                                <div class="form-text">Timezone for scheduling and limits</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="dailyEmailLimit" class="form-label fw-semibold">Daily Email Limit</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="dailyEmailLimit" 
                                                           value="50" min="1" max="500">
                                                    <span class="input-group-text">per day</span>
                                                </div>
                                                <div class="form-text">Maximum emails in 24 hours</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Random Delay Settings -->
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <h6 class="fw-semibold mb-3">
                                                <i class="fas fa-random me-2"></i>Random Delay Configuration
                                                <small class="text-muted">(for spam prevention)</small>
                                            </h6>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="randomDelayMin" class="form-label fw-semibold">Minimum Additional Delay</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="randomDelayMin" 
                                                           value="1" min="0" max="60">
                                                    <span class="input-group-text">minutes</span>
                                                </div>
                                                <div class="form-text">Minimum random delay added to base interval</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="randomDelayMax" class="form-label fw-semibold">Maximum Additional Delay</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="randomDelayMax" 
                                                           value="5" min="0" max="120">
                                                    <span class="input-group-text">minutes</span>
                                                </div>
                                                <div class="form-text">Maximum random delay added to base interval</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="alert alert-info mb-0">
                                                <small>
                                                    <i class="fas fa-info-circle me-1"></i>
                                                    <strong>How it works:</strong> Each email will be sent with a random delay between the min and max values 
                                                    added to your base interval. This helps avoid spam detection by varying send times.
                                                    <br>
                                                    <strong>Example:</strong> Base interval 30min + random 1-5min = emails sent 31-35 minutes apart.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Business Hours Settings -->
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="respectBusinessHours" checked>
                                                <label class="form-check-label fw-semibold" for="respectBusinessHours">
                                                    <i class="fas fa-clock me-1"></i>Respect Business Hours
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row" id="businessHoursSettings">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="businessStartTime" class="form-label">Start Time</label>
                                                <input type="time" class="form-control" id="businessStartTime" value="09:00">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="businessEndTime" class="form-label">End Time</label>
                                                <input type="time" class="form-control" id="businessEndTime" value="17:00">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Business Days</label>
                                                <div class="d-flex flex-wrap gap-2">
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="businessMon" checked>
                                                        <label class="form-check-label" for="businessMon">Mon</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="businessTue" checked>
                                                        <label class="form-check-label" for="businessTue">Tue</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="businessWed" checked>
                                                        <label class="form-check-label" for="businessWed">Wed</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="businessThu" checked>
                                                        <label class="form-check-label" for="businessThu">Thu</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="businessFri" checked>
                                                        <label class="form-check-label" for="businessFri">Fri</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="businessSat">
                                                        <label class="form-check-label" for="businessSat">Sat</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="businessSun">
                                                        <label class="form-check-label" for="businessSun">Sun</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                        <!-- Manual Mode Settings -->
                        <div id="manualModeSettings" style="display: none;">
                            <div class="card border-success mb-4">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-hand-paper me-2"></i>Manual Execution Settings
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info mb-3">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>How Manual Execution Works:</strong>
                                        <ol class="mb-0 mt-2">
                                            <li>Campaign contacts will be available in the <strong>Compose tab</strong></li>
                                            <li>Select any contact from this campaign to compose personalized emails</li>
                                            <li>Template and settings will be pre-applied automatically</li>
                                            <li>Send emails individually or in batches as you choose</li>
                                        </ol>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="manualFollowupDays" class="form-label fw-semibold">Follow-up Reminder</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" id="manualFollowupDays" 
                                                           placeholder="7" min="1" max="30" value="7">
                                                    <span class="input-group-text">days later</span>
                                                </div>
                                                <div class="form-text">Remind you to follow up with non-responders</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="form-check mt-4">
                                                    <input class="form-check-input" type="checkbox" id="enableComposePriority" checked>
                                                    <label class="form-check-label fw-semibold" for="enableComposePriority">
                                                        <i class="fas fa-star me-1 text-warning"></i>Prioritize in Compose Tab
                                                    </label>
                                                    <div class="form-text">Show this campaign's contacts at the top of the compose list</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Step 4: Review & Launch -->
                    <div class="step-content d-none" id="step4" data-step="4">
                        <div class="step-header">
                            <h4 class="step-title">
                                <i class="fas fa-rocket text-primary me-2"></i>Review & Launch
                            </h4>
                            <p class="text-muted">Review your campaign settings before launching</p>
                        </div>

                        <div class="row">
                            <div class="col-md-8">
                                <div class="campaign-review-card">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0" id="reviewCampaignName">Campaign Name</h5>
                                            <small id="reviewCampaignType">Campaign Type</small>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-6">
                                                    <div class="review-item">
                                                        <strong>Target Contacts:</strong>
                                                        <span id="reviewContactCount" class="badge bg-success ms-2">0</span>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="review-item">
                                                        <strong>Email Template:</strong>
                                                        <span id="reviewEmailTemplate" class="text-muted">Not selected</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-12">
                                                    <div class="review-item">
                                                        <strong>Follow-up:</strong>
                                                        <span id="reviewFollowup">3 days</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Email Sending Settings Review -->
                                            <div class="mt-3 border-top pt-3">
                                                <h6 class="fw-semibold mb-2">
                                                    <i class="fas fa-cog me-1"></i>Email Settings
                                                </h6>
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="review-item small">
                                                            <strong>Frequency:</strong>
                                                            <span id="reviewEmailFrequency" class="text-muted">30 minutes</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="review-item small">
                                                            <strong>Daily Limit:</strong>
                                                            <span id="reviewDailyLimit" class="text-muted">50 emails</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <div class="col-6">
                                                        <div class="review-item small">
                                                            <strong>Timezone:</strong>
                                                            <span id="reviewTimezone" class="text-muted">Pacific Time</span>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="review-item small">
                                                            <strong>Business Hours:</strong>
                                                            <span id="reviewBusinessHours" class="text-muted">Enabled</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="campaign-stats-preview">
                                    <h6 class="fw-semibold mb-3">Campaign Insights</h6>
                                    <div class="stats-item mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>Estimated Reach:</span>
                                            <strong id="estimatedReach">0 contacts</strong>
                                        </div>
                                    </div>
                                    <div class="stats-item mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>Expected Responses:</span>
                                            <strong id="expectedResponses">~0 replies</strong>
                                        </div>
                                        <small class="text-muted">Based on 15% response rate</small>
                                    </div>
                                    <div class="stats-item">
                                        <div class="d-flex justify-content-between">
                                            <span>Launch Time:</span>
                                            <strong id="launchTime">Immediately</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Step Navigation Footer -->
            <div class="modal-footer">
                <div class="d-flex justify-content-between w-100">
                    <div>
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancel
                        </button>
                        <button type="button" class="btn btn-outline-info" id="saveDraftBtn" onclick="saveCampaignDraft()">
                            <i class="fas fa-save me-1"></i>Save as Draft
                        </button>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn btn-outline-primary" id="prevStepBtn" onclick="previousStep()" disabled>
                            <i class="fas fa-chevron-left me-1"></i>Previous
                        </button>
                        <button type="button" class="btn btn-primary" id="nextStepBtn" onclick="nextStep()">
                            Next<i class="fas fa-chevron-right ms-1"></i>
                        </button>
                        <button type="button" class="btn btn-success" id="saveCampaignBtn" onclick="createCampaign()" style="display: none;">
                            <i class="fas fa-save me-1"></i>Save Campaign
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Campaign Details Modal -->
<div class="modal fade" id="campaignDetailsModal" tabindex="-1" aria-labelledby="campaignDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="campaignDetailsModalLabel">
                    <i class="fas fa-chart-line me-2"></i><span id="campaignDetailsTitle">Campaign Details</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <!-- Campaign Overview Section -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle me-2"></i>Campaign Overview
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>Campaign Name:</strong>
                                            <div id="detailsCampaignName" class="text-muted">Loading...</div>
                                        </div>
                                        <div class="mb-3">
                                            <strong>Campaign Type:</strong>
                                            <div id="detailsCampaignType" class="text-muted">Loading...</div>
                                        </div>
                                        <div class="mb-3">
                                            <strong>Status:</strong>
                                            <span id="detailsCampaignStatus" class="badge">Loading...</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>Email Template:</strong>
                                            <div id="detailsEmailTemplate" class="text-muted">Loading...</div>
                                        </div>
                                        <div class="mb-3">
                                            <strong>Follow-up Days:</strong>
                                            <div id="detailsFollowupDays" class="text-muted">Loading...</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>Created:</strong>
                                            <div id="detailsCreatedAt" class="text-muted">Loading...</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>Last Updated:</strong>
                                            <div id="detailsUpdatedAt" class="text-muted">Loading...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-chart-bar me-2"></i>Campaign Metrics
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Total Contacts:</span>
                                        <strong id="detailsTotalContacts" class="text-primary">0</strong>
                                    </div>
                                </div>
                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Emails Sent:</span>
                                        <strong id="detailsEmailsSent" class="text-success">0</strong>
                                    </div>
                                </div>
                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Failed Emails:</span>
                                        <strong id="detailsFailedEmails" class="text-danger">0</strong>
                                    </div>
                                </div>
                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Success Rate:</span>
                                        <strong id="detailsSuccessRate" class="text-info">0%</strong>
                                    </div>
                                </div>
                                <div class="metric-item mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Responses:</span>
                                        <strong id="detailsResponses" class="text-warning">0</strong>
                                    </div>
                                </div>
                                <div class="metric-item">
                                    <div class="d-flex justify-content-between">
                                        <span>Active Contacts:</span>
                                        <strong id="detailsActiveContacts" class="text-primary">0</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campaign Progress Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-tasks me-2"></i>Campaign Progress
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="progress-stat text-center">
                                            <div class="progress mb-2" style="height: 8px;">
                                                <div id="detailsActiveProgress" class="progress-bar bg-primary" style="width: 0%"></div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <small>Active</small>
                                                <small id="detailsActiveCount">0</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="progress-stat text-center">
                                            <div class="progress mb-2" style="height: 8px;">
                                                <div id="detailsCompletedProgress" class="progress-bar bg-success" style="width: 0%"></div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <small>Completed</small>
                                                <small id="detailsCompletedCount">0</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="progress-stat text-center">
                                            <div class="progress mb-2" style="height: 8px;">
                                                <div id="detailsPausedProgress" class="progress-bar bg-warning" style="width: 0%"></div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <small>Paused</small>
                                                <small id="detailsPausedCount">0</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="progress-stat text-center">
                                            <div class="progress mb-2" style="height: 8px;">
                                                <div id="detailsFailedProgress" class="progress-bar bg-danger" style="width: 0%"></div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <small>Failed</small>
                                                <small id="detailsFailedCount">0</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Email Timeline Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-secondary text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-clock me-2"></i>Email Timeline
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>First Email Sent:</strong>
                                            <div id="detailsFirstEmail" class="text-muted">No emails sent yet</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>Last Email Sent:</strong>
                                            <div id="detailsLastEmail" class="text-muted">No emails sent yet</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>Unique Recipients:</strong>
                                            <div id="detailsUniqueRecipients" class="text-muted">0</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <strong>Total Emails:</strong>
                                            <div id="detailsTotalEmails" class="text-muted">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campaign Contacts Section -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-users me-2"></i>Campaign Contacts
                                    <span class="badge bg-light text-primary ms-2" id="contactsCount">0</span>
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="campaignContactsList">
                                    <div class="text-center text-muted py-3">
                                        <i class="fas fa-spinner fa-spin me-2"></i>Loading contacts...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campaign Controls Section -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-dark text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-cogs me-2"></i>Campaign Controls
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex gap-2" id="campaignControlButtons">
                                    <button type="button" class="btn btn-outline-warning" id="pauseCampaignBtn" style="display: none;">
                                        <i class="fas fa-pause me-1"></i>Pause Campaign
                                    </button>
                                    <button type="button" class="btn btn-outline-success" id="resumeCampaignBtn" style="display: none;">
                                        <i class="fas fa-play me-1"></i>Resume Campaign
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" id="editCampaignBtn" style="display: none;">
                                        <i class="fas fa-edit me-1"></i>Edit Campaign
                                    </button>
                                    <button type="button" class="btn btn-warning" id="executeNowBtn" style="display: none;" 
                                            title="‚ö†Ô∏è TEST MODE: Execute campaign immediately bypassing all time delays">
                                        <i class="fas fa-rocket me-1"></i>Execute Now (Test)
                                    </button>
                                    <button type="button" class="btn btn-outline-warning" id="resetCampaignBtn" style="display: none;"
                                            title="üîÑ TEST MODE: Reset campaign contacts to 'active' for retesting">
                                        <i class="fas fa-undo me-1"></i>Reset for Testing
                                    </button>
                                    <button type="button" class="btn btn-outline-success" id="updateToDeepResearchBtn" style="display: none;"
                                            title="üî¨ Update campaign to use Deep Research template with report links">
                                        <i class="fas fa-microscope me-1"></i>Enable Deep Research
                                    </button>
                                    <button type="button" class="btn btn-outline-info" id="refreshCampaignBtn">
                                        <i class="fas fa-sync-alt me-1"></i>Refresh Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Campaign Analytics Modal -->
<div class="modal fade" id="campaignAnalyticsModal" tabindex="-1" aria-labelledby="campaignAnalyticsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="campaignAnalyticsModalLabel">
                    <i class="fas fa-chart-line me-2"></i><span id="campaignAnalyticsTitle">Campaign Analytics</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                {% include 'components/campaign_analytics_pane.html' %}
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Campaign Schedule Modal -->
<div class="modal fade" id="campaignScheduleModal" tabindex="-1" aria-labelledby="campaignScheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="campaignScheduleModalLabel">
                    <i class="fas fa-clock me-2"></i><span id="campaignScheduleTitle">Campaign Schedule</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <div id="scheduleContent">
                    <!-- Schedule content will be loaded here -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Close
                </button>
            </div>
        </div>
    </div>
</div> 